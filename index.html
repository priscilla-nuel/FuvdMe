<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FundMe DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6/dist/ethers.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: #fff;
            padding: 2rem 3rem;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 350px;
        }

        h1 {
            margin-bottom: 1.5rem;
            color: #333;
        }

        input {
            padding: 0.5rem;
            width: 60%;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-right: 0.5rem;
        }

        button {
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            background-color: #4f46e5;
            color: white;
            font-weight: bold;
            transition: background-color 0.2s;
            margin: 0.5rem 0;
        }

        button:hover {
            background-color: #4338ca;
        }

        #status {
            margin-top: 1rem;
            font-weight: bold;
            color: #555;
        }

        #account {
            margin-bottom: 1rem;
            color: #333;
            font-size: 0.9rem;
            word-break: break-all;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>FundMe DApp</h1>

        <button id="connectBtn">Connect Wallet</button>
        <p id="account"></p>

        <div>
            <input id="fundAmount" type="text" placeholder="ETH amount">
            <button id="fundBtn">Fund</button>
        </div>

        <div>
            <button id="withdrawBtn">Withdraw (Owner Only)</button>
        </div>

        <p id="status"></p>
    </div>

    <script type="module">
        import FundMeAbi from './FundMe.json' assert { type: 'json' };

        const contractAddress = "0x0dE9967DBe2262A1D17a517B0Aef947eB9520dEC"; // Your deployed contract
        let provider;
        let signer;
        let contract;

        const connectBtn = document.getElementById('connectBtn');
        const fundBtn = document.getElementById('fundBtn');
        const withdrawBtn = document.getElementById('withdrawBtn');
        const accountP = document.getElementById('account');
        const statusP = document.getElementById('status');

        async function connectWallet() {
            try {
                if (!window.ethereum) return alert("MetaMask not detected!");
                provider = new ethers.BrowserProvider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = await provider.getSigner();
                const account = await signer.getAddress();
                accountP.innerText = `Connected as: ${account}`;
                contract = new ethers.Contract(contractAddress, FundMeAbi, signer);
                connectBtn.innerText = "Wallet Connected";
                connectBtn.disabled = true;
            } catch (err) {
                console.error(err);
                alert("Failed to connect wallet");
            }
        }

        async function fund() {
            if (!contract) return alert("Connect wallet first!");
            const amount = document.getElementById('fundAmount').value;
            if (!amount || isNaN(amount) || Number(amount) <= 0) {
                alert("Enter a valid ETH amount");
                return;
            }
            try {
                statusP.innerText = "Sending transaction...";
                const tx = await contract.fund({ value: ethers.parseEther(amount) });
                await tx.wait();
                statusP.innerText = `Funding of ${amount} ETH complete!`;
            } catch (err) {
                console.error(err);
                statusP.innerText = "Transaction failed";
            }
        }

        async function withdraw() {
            if (!contract) return alert("Connect wallet first!");
            try {
                statusP.innerText = "Sending withdraw transaction...";
                const tx = await contract.withdraw();
                await tx.wait();
                statusP.innerText = "Withdraw successful!";
            } catch (err) {
                console.error(err);
                statusP.innerText = "Withdraw failed (not owner or error)";
            }
        }

        connectBtn.addEventListener('click', connectWallet);
        fundBtn.addEventListener('click', fund);
        withdrawBtn.addEventListener('click', withdraw);
    </script>
</body>

</html>